内联汇编代码的编码格式:

```__asm__ __volatile__("assembly" : output operands : input operands : clobbered registers);```

### 1. 语法格式逻辑
内联汇编由四个部分组成，彼此之间用冒号 `:` 分隔：

| 组成部分 | 语法格式 | 释义 | 核心注意点 |
| :--- | :--- | :--- | :--- |
| **关键字** | `__asm__` | 声明内联汇编代码开始 | 也可以写成 `asm` |
| **限定符** | `__volatile__` | 禁止编译器对该段代码进行优化 | **OS开发必加**，防止指令被误删 |
| **汇编代码** | `"assembly"` | 以字符串形式编写的汇编指令 | 多行指令需用 `\n\t` 分隔 |
| **输出部** | `: output` | 汇编结果存入哪些 C 变量 | 常用 `"=r"` 表示通过寄存器写入变量 |
| **输入部** | `: input` | 汇编需要用到的 C 变量/常量 | 常用 `"r"` (寄存器) 或 `"i"` (立即数) |
| **破坏部** | `: clobber` | 告知哪些寄存器或内存被改动了 | 填 `"memory"` 可建立内存屏障 |

---

### 2. 标准代码模板
在编写 OS 内核（如 RISC-V）时，通常采用这种多行格式，可读性最好：

```c
__asm__ __volatile__(
    "指令1 操作数1, 操作数2 \n\t"
    "指令2 操作数1, 操作数2 \n\t"
    : [out] "=r" (c_var_out)   /* 输出部 */
    : [in]  "r"  (c_var_in)    /* 输入部 */
    : "memory", "t0"           /* 破坏部：告诉编译器内存和 t0 寄存器被改了 */
);